package org.kuali.kra.s2s.depend;

import org.kuali.kra.proposaldevelopment.bo.Narrative;
import org.kuali.rice.krad.data.DataObjectService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Component;

import java.util.List;

@Component("narrativeCleanupService")
public class NarrativeCleanupServiceImpl implements NarrativeCleanupService {

    public static final int ADDITIONAL_KEYPERSONS_ATTACHMENT = 11;
    public static final int ADDITIONAL_EQUIPMENT_ATTACHMENT = 12;

    @Autowired
    @Qualifier("dataObjectService")
    private DataObjectService dataObjectService;

    @Override
    public void deleteAutoGeneratedNarratives(List<Narrative> narratives) {
        if (narratives == null) {
            throw new IllegalArgumentException("narratives is null");
        }

        for (Narrative narrative : narratives) {
            if (isAutoGeneratedNarrative(narrative)) {
                dataObjectService.delete(narrative);
            }
        }
    }

    @Override
    public boolean isAutoGeneratedNarrative(Narrative narrative) {
        if (narrative == null) {
            throw new IllegalArgumentException("narrative is null");
        }

        final String typeCode = narrative.getNarrativeTypeCode();

        return typeCode != null
                && (Integer.parseInt(typeCode) == ADDITIONAL_KEYPERSONS_ATTACHMENT ||
                Integer.parseInt(typeCode) == ADDITIONAL_EQUIPMENT_ATTACHMENT);
    }

    public DataObjectService getDataObjectService() {
        return dataObjectService;
    }

    public void setDataObjectService(DataObjectService dataObjectService) {
        this.dataObjectService = dataObjectService;
    }
}
