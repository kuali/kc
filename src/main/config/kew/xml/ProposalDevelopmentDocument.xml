<?xml version="1.0" encoding="UTF-8"?>
<data xmlns="ns:workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ns:workflow resource:WorkflowData">

	<ruleAttributes xmlns="ns:workflow/RuleAttribute" xsi:schemaLocation="ns:workflow/RuleAttribute resource:RuleAttribute">
		<ruleAttribute>
		       <name>CopyCustomActionListAttribute</name>
		       <className>org.kuali.kra.workflow.CopyCustomActionListAttribute</className>
		       <label>Copy Action List Attribute</label>
		       <description>Copy Action List Attribute</description>
		       <type>ActionListAttribute</type>
        </ruleAttribute>
      
		<ruleAttribute>
			<name>AggregatorSearchAttribute</name>
			<className>edu.iu.uis.eden.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
			<label>AggregatorSearchAttribute</label>
			<description>AggregatorSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<searchingConfig>
				<fieldDef name="aggregator" title="Aggregator">
					<display>
						<type>text</type>
					</display>
					<!-- This will probably use kimpersonservice ? -->
					<quickfinder service="UserLookupableImplService" appliesTo="networkId" draw="true" />
					<fieldEvaluation>
					    <!-- not sure yet -->
					    <!--  example //organization/organizationId -->
						<xpathexpression>//aggregator/string</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
				<xmlSearchContent>
					<users>
						<aggregator>
							<value>%aggregator%</value>
						</aggregator>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>BudgetCreatorSearchAttribute</name>
			<className>edu.iu.uis.eden.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
			<label>BudgetCreatorSearchAttribute</label>
			<description>BudgetCreatorSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<searchingConfig>		
			 <fieldDef name="budgetCreator" title="Budget Creator">
					<display>
						<type>text</type>
					</display>
					<quickfinder service="UserLookupableImplService" appliesTo="networkId" draw="true" /> 
					<fieldEvaluation>
						<xpathexpression>//budgetcreator/string</xpathexpression>
					</fieldEvaluation> 
				</fieldDef>
				<xmlSearchContent>
					<users>
						<budgetCreator>
							<value>%budgetCreator%</value>
						</budgetCreator>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>NarrativeWriterSearchAttribute</name>
			<className>edu.iu.uis.eden.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
			<label>NarrativeWriterSearchAttribute</label>
			<description>NarrativeWriterSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<searchingConfig>		
				<fieldDef name="narrativeWriter" title="Narrative Writer">
					<display>
						<type>text</type>
					</display>
					<quickfinder service="UserLookupableImplService" appliesTo="networkId" draw="true" />
					<fieldEvaluation>
						<xpathexpression>//narrativewriter/string</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
				<xmlSearchContent>
					<users>
						<narrativeWriter>
							<value>%narrativeWriter%</value>
						</narrativeWriter>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>ViewerSearchAttribute</name>
			<className>edu.iu.uis.eden.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
			<label>ViewerSearchAttribute</label>
			<description>ViewerSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<searchingConfig>		
				<fieldDef name="viewer" title="Viewer">
					<display>
						<type>text</type>
					</display>
					<quickfinder service="UserLookupableImplService" appliesTo="networkId" draw="true" />
					<fieldEvaluation>
						<xpathexpression>//viewer/string</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
				<xmlSearchContent>
					<users>
						<viewer>
							<value>%viewer%</value>
						</viewer>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		
		<!-- custom attribute -->
		<ruleAttribute>
            <name>CustomDataAttribute</name>
            <className>edu.iu.uis.eden.routetemplate.xmlrouting.StandardGenericXMLRuleAttribute</className>
            <label>CustomDataAttribute</label>
            <description>CustomDataAttribute</description>
            <type>RuleXmlAttribute</type>
            <routingConfig>
              <fieldDef name="numberOfTrainees" title="Number Of Trainees" workflowType="RULE">
                    <display>
                        <type>text</type>
                    </display>
                    <validation required="false"/>
                    <fieldEvaluation>
                         <!-- expectation: this is run and evaluates to true -->
                         <xpathexpression>wf:xstreamsafe('//document/ownedByUnitNumber') = 'IN-CARR' and wf:xstreamsafe("//xmlRouting/field[@name='numberOfTrainees']/value") &gt;= wf:ruledata('numberOfTrainees')</xpathexpression>
                    </fieldEvaluation>
              </fieldDef>
            </routingConfig>
            </ruleAttribute>
            <ruleAttribute>
            <name>DepartmentalApprovalAttribute</name>
            <className>edu.iu.uis.eden.routetemplate.xmlrouting.StandardGenericXMLRuleAttribute</className>
            <label>DepartmentalApprovalAttribute</label>
            <description>DepartmentalApprovalAttribute</description>
            <type>RuleXmlAttribute</type>
            <routingConfig>
              <fieldDef name="totalCost" title="Toal" workflowType="RULE">
                    <display>
                        <type>text</type>
                    </display>
                    <validation required="false"/>
                    <fieldEvaluation>
                         
                          <xpathexpression>wf:xstreamsafe('//document/ownedByUnitNumber') = 'IN-CARD' and wf:xstreamsafe("//budgetVersionOverviews/org.kuali.kra.budget.bo.BudgetVersionOverview/totalCost/value") &gt;= wf:ruledata('totalCost')</xpathexpression>
                     </fieldEvaluation>
              </fieldDef>
            </routingConfig>
            </ruleAttribute>
			<!-- Role attribute -->
		<ruleAttribute>
			<name>ProposalPersonRoleAttribute</name>
			<className>
				org.kuali.kra.workflow.ProposalPersonRoleAttribute
			</className>
			<label>Proposal Routing</label>
			<description>Proposal Routing</description>
			<type>RuleAttribute</type>
		</ruleAttribute>
			
	</ruleAttributes>

	<documentTypes xmlns="ns:workflow/DocumentType" xsi:schemaLocation="ns:workflow/DocumentType resource:DocumentType">
		<documentType>
      <name>ProposalDevelopmentDocument</name>
      <description>Create an Awesome Development Proposal</description>
      <label>KRA Proposal Development</label>
      <postProcessorName>org.kuali.workflow.postprocessor.KualiPostProcessor</postProcessorName>
      <superUserWorkgroupName>WorkflowAdmin</superUserWorkgroupName>
      <blanketApproveWorkgroupName>WorkflowAdmin</blanketApproveWorkgroupName>
      <defaultExceptionWorkgroupName>WorkflowAdmin</defaultExceptionWorkgroupName>
      <docHandler>${kuali.docHandler.url.prefix}/proposalDevelopmentProposal.do?methodToCall=docHandler</docHandler>
      <active>true</active>
      <policies>
       <policy> 
      <name>LOOK_FUTURE</name> 
      <value>true</value> 
     </policy> 
      </policies>
     <attributes>
	 	<attribute>
      		<name>CopyCustomActionListAttribute</name>
        </attribute>
        <attribute>
          <name>AggregatorSearchAttribute</name>
        </attribute>
        <attribute>
          <name>BudgetCreatorSearchAttribute</name>
        </attribute>
        <attribute>
          <name>NarrativeWriterSearchAttribute</name>
        </attribute>
        <attribute>
          <name>ViewerSearchAttribute</name>
        </attribute>
        </attributes>
      <routingVersion>2</routingVersion>
      <routePaths>
        <routePath>
          <start name="Initiated" nextNode="OSPInitial" />
          <requests name="OSPInitial" nextNode="ProposalPersons" />
          <requests name="ProposalPersons" nextNode="UnitRouting" />
          <requests name="UnitRouting" nextNode="DepartmentalRouting" />
          <requests name="DepartmentalRouting" nextNode="OSPOfficeRouting" />
          <requests name="OSPOfficeRouting" />
        </routePath>
      </routePaths>
      <routeNodes>
        <start name="Initiated">
          <activationType>P</activationType>
          <mandatoryRoute>false</mandatoryRoute>
          <finalApproval>false</finalApproval>
        </start>
        <requests name="OSPInitial">
          <activationType>S</activationType>
          <ruleTemplate>OSPInitialApproval</ruleTemplate>
          <mandatoryRoute>false</mandatoryRoute>
          <finalApproval>false</finalApproval>
        </requests>
        <requests name="ProposalPersons">
          <activationType>P</activationType>
          <ruleTemplate>ProposalPersonsApproval</ruleTemplate>
          <mandatoryRoute>false</mandatoryRoute>
          <finalApproval>false</finalApproval>
        </requests>
        <requests name="UnitRouting">
          <activationType>P</activationType>
          <ruleTemplate>CustomApproval</ruleTemplate>
          <mandatoryRoute>false</mandatoryRoute>
          <finalApproval>false</finalApproval>
        </requests>
        <requests name="DepartmentalRouting">
          <activationType>P</activationType>
          <ruleTemplate>DepartmentalApproval</ruleTemplate>
          <mandatoryRoute>false</mandatoryRoute>
          <finalApproval>false</finalApproval>
        </requests>
        <requests name="OSPOfficeRouting">
          <activationType>S</activationType>
          <ruleTemplate>OSPOfficeApproval</ruleTemplate>
          <mandatoryRoute>false</mandatoryRoute>
          <finalApproval>false</finalApproval>
        </requests>
      </routeNodes>
    </documentType>
	</documentTypes>
	<ruleTemplates xmlns="ns:workflow/RuleTemplate" xsi:schemaLocation="ns:workflow/RuleTemplate resource:RuleTemplate">
      <ruleTemplate allowOverwrite="true">
			<name>OSPInitialApproval</name>
			<description>OSP Initial Approval Routing Rule</description>
	  </ruleTemplate>
	  <ruleTemplate allowOverwrite="true">
			<name>ProposalPersonsApproval</name>
			<description>ProposalPersons Approval Routing Rule</description>
			  <attributes>
                  <attribute>
                    <name>ProposalPersonRoleAttribute</name>
                    <required>false</required>
                   </attribute>
               </attributes>
	 </ruleTemplate>
	 <ruleTemplate allowOverwrite="true">  
		 <name>OSPOfficeApproval</name>
		  <description>
				OSP Office Approval Routing Rule 
		  </description>
	 </ruleTemplate>
	<ruleTemplate allowOverwrite="true">
      <name>CustomApproval</name>
      <description>Custom Approval Routing Rule</description>
        <attributes>
           <attribute>
              <name>CustomDataAttribute</name>
           <required>false</required>
        </attribute>
      </attributes>
    </ruleTemplate>
     <ruleTemplate allowOverwrite="true">
      <name>DepartmentalApproval</name>
      <description>Department Approval Routing Rule</description>
      <attributes>
        <attribute>
          <name>DepartmentalApprovalAttribute</name>
          <required>false</required>
        </attribute>
      </attributes>
    </ruleTemplate>
    </ruleTemplates>
</data>