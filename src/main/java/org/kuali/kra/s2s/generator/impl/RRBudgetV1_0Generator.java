/*
 * Copyright 2008 The Kuali Foundation.
 * 
 * Licensed under the Educational Community License, Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.opensource.org/licenses/ecl1.php
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.kuali.kra.s2s.generator.impl;

import gov.grants.apply.forms.rrBudgetV10.BudgetTypeDataType;
import gov.grants.apply.forms.rrBudgetV10.BudgetYear1DataType;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType;
import gov.grants.apply.forms.rrBudgetV10.KeyPersonCompensationDataType;
import gov.grants.apply.forms.rrBudgetV10.KeyPersonDataType;
import gov.grants.apply.forms.rrBudgetV10.OtherPersonnelDataType;
import gov.grants.apply.forms.rrBudgetV10.RRBudgetDocument;
import gov.grants.apply.forms.rrBudgetV10.SectBCompensationDataType;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.BudgetPeriod;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.Equipment;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.IndirectCosts;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.KeyPersons;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.OtherDirectCosts;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.OtherPersonnel;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.ParticipantTraineeSupportCosts;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.Travel;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.Equipment.AdditionalEquipmentsAttachment;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.Equipment.EquipmentList;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.Equipment.TotalFundForAttachedEquipment;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.KeyPersons.AttachedKeyPersons;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.KeyPersons.TotalFundForAttachedKeyPersons;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.OtherDirectCosts.Others;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.OtherPersonnel.GraduateStudents;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.OtherPersonnel.PostDocAssociates;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.OtherPersonnel.SecretarialClerical;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.OtherPersonnel.UndergraduateStudents;
import gov.grants.apply.forms.rrBudgetV10.BudgetYearDataType.ParticipantTraineeSupportCosts.Other;
import gov.grants.apply.forms.rrBudgetV10.RRBudgetDocument.RRBudget;
import gov.grants.apply.forms.rrBudgetV10.RRBudgetDocument.RRBudget.BudgetSummary;
import gov.grants.apply.forms.rrBudgetV10.RRBudgetDocument.RRBudget.BudgetSummary.CumulativeEquipments;
import gov.grants.apply.forms.rrBudgetV10.RRBudgetDocument.RRBudget.BudgetSummary.CumulativeOtherDirect;
import gov.grants.apply.forms.rrBudgetV10.RRBudgetDocument.RRBudget.BudgetSummary.CumulativeTrainee;
import gov.grants.apply.forms.rrBudgetV10.RRBudgetDocument.RRBudget.BudgetSummary.CumulativeTravels;
import gov.grants.apply.system.attachmentsV10.AttachedFileDataType.FileLocation;
import gov.grants.apply.system.globalLibraryV10.YesNoDataType;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.LinkedHashMap;
import java.util.List;

import org.apache.log4j.Logger;
import org.apache.xmlbeans.XmlObject;
import org.kuali.kra.budget.BudgetDecimal;
import org.kuali.kra.proposaldevelopment.bo.Narrative;
import org.kuali.kra.proposaldevelopment.document.ProposalDevelopmentDocument;
import org.kuali.kra.s2s.S2SException;
import org.kuali.kra.s2s.generator.bo.AttachmentData;
import org.kuali.kra.s2s.generator.bo.BudgetPeriodInfo;
import org.kuali.kra.s2s.generator.bo.BudgetSummaryInfo;
import org.kuali.kra.s2s.generator.bo.CompensationInfo;
import org.kuali.kra.s2s.generator.bo.CostInfo;
import org.kuali.kra.s2s.generator.bo.IndirectCostDetails;
import org.kuali.kra.s2s.generator.bo.KeyPersonInfo;
import org.kuali.kra.s2s.generator.bo.OtherDirectCostInfo;
import org.kuali.kra.s2s.generator.bo.OtherPersonnelInfo;
import org.kuali.kra.s2s.util.S2SConstants;

/**
 * 
 * This class is used to generate XML Document object for grants.gov RRBudgetV1.0. This form is generated using XMLBean API's
 * generated by compiling RRBudgetV1.0 schema.
 * 
 * @author Kuali Research Administration Team (kualidev@oncourse.iu.edu)
 */
public class RRBudgetV1_0Generator extends RRBudgetBaseGenerator {

    private static final Logger LOG = Logger.getLogger(RRBudgetV1_0Generator.class);


    /**
     * This method returns RRBudgetDocument object based on proposal development document which contains the informations such as
     * DUNSID,OrganizationName,BudgetType,BudgetYear and BudgetSummary.
     * 
     * @return rrBudgetDocument {@link XmlObject} of type RRBudgetDocument.
     */
    private RRBudgetDocument getRRBudget() {

        RRBudgetDocument rrBudgetDocument = RRBudgetDocument.Factory.newInstance();
        RRBudgetDocument.RRBudget rrBudget = RRBudgetDocument.RRBudget.Factory.newInstance();
        rrBudget.setFormVersion(S2SConstants.FORMVERSION_1_0);
        if (pdDoc.getDevelopmentProposal().getOrganization() != null) {
            rrBudget.setDUNSID(pdDoc.getDevelopmentProposal().getOrganization().getDunsNumber());
            rrBudget.setOrganizationName(pdDoc.getDevelopmentProposal().getOrganization().getOrganizationName());
        }
        rrBudget.setBudgetType(BudgetTypeDataType.PROJECT);
        // Set default values for mandatory fields
        rrBudget.setBudgetYear1(BudgetYear1DataType.Factory.newInstance());

        List<BudgetPeriodInfo> budgetperiodList;
        BudgetSummaryInfo budgetSummary = null;
        try {
            budgetperiodList = s2sBudgetCalculatorService.getBudgetPeriods(pdDoc);
            budgetSummary = s2sBudgetCalculatorService.getBudgetInfo(pdDoc);
        }
        catch (S2SException e) {
            LOG.error(e.getMessage(), e);
            return rrBudgetDocument;
        }

        for (BudgetPeriodInfo budgetPeriodData : budgetperiodList) {
            if (budgetPeriodData.getBudgetPeriod() == BudgetPeriodInfo.BUDGET_PERIOD_1) {
                rrBudget.setBudgetYear1(getBudgetYear1DataType(budgetPeriodData));
            }
            else if (budgetPeriodData.getBudgetPeriod() == BudgetPeriodInfo.BUDGET_PERIOD_2) {
                rrBudget.setBudgetYear2(getBudgetYearDataType(budgetPeriodData));
            }
            else if (budgetPeriodData.getBudgetPeriod() == BudgetPeriodInfo.BUDGET_PERIOD_3) {
                rrBudget.setBudgetYear3(getBudgetYearDataType(budgetPeriodData));
            }
            else if (budgetPeriodData.getBudgetPeriod() == BudgetPeriodInfo.BUDGET_PERIOD_4) {
                rrBudget.setBudgetYear4(getBudgetYearDataType(budgetPeriodData));
            }
            else if (budgetPeriodData.getBudgetPeriod() == BudgetPeriodInfo.BUDGET_PERIOD_5) {
                rrBudget.setBudgetYear5(getBudgetYearDataType(budgetPeriodData));
            }
        }
        rrBudget.setBudgetSummary(getBudgetSummary(budgetSummary));
        rrBudgetDocument.setRRBudget(rrBudget);
        return rrBudgetDocument;
    }

    /**
     * This method gets BudgetYear1DataType details like BudgetPeriodStartDate,BudgetPeriodEndDate,BudgetPeriod
     * KeyPersons,OtherPersonnel,TotalCompensation,Equipment,ParticipantTraineeSupportCosts,Travel,OtherDirectCosts
     * DirectCosts,IndirectCosts,CognizantFederalAgency,TotalCosts and BudgetJustificationAttachment based on BudgetPeriodInfo for
     * the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return BudgetYear1DataType corresponding to the BudgetPeriodInfo entry.
     */
    private BudgetYear1DataType getBudgetYear1DataType(BudgetPeriodInfo periodInfo) {

        BudgetYear1DataType budgetYear = BudgetYear1DataType.Factory.newInstance();
        budgetYear.setBudgetPeriodStartDate(s2sUtilService.convertDateToCalendar(periodInfo.getStartDate()));
        budgetYear.setBudgetPeriodEndDate(s2sUtilService.convertDateToCalendar(periodInfo.getEndDate()));
        BudgetPeriod.Enum budgetPeriod = BudgetPeriod.Enum.forInt(periodInfo.getBudgetPeriod());
        budgetYear.setBudgetPeriod(budgetPeriod);
        budgetYear.setKeyPersons(getKeyPersons(periodInfo));
        budgetYear.setOtherPersonnel(getOtherPersonnel(periodInfo));
        if (periodInfo.getTotalCompensation() != null) {
            budgetYear.setTotalCompensation(periodInfo.getTotalCompensation().bigDecimalValue());   
        }
        budgetYear.setEquipment(getEquipment(periodInfo));
        budgetYear.setTravel(getTravel(periodInfo));
        budgetYear.setParticipantTraineeSupportCosts(getParticipantTraineeSupportCosts(periodInfo));
        budgetYear.setOtherDirectCosts(getOtherDirectCosts(periodInfo));
        budgetYear.setDirectCosts(periodInfo.getDirectCostsTotal().bigDecimalValue());
        IndirectCosts indirectCosts = getIndirectCosts(periodInfo);
        if(indirectCosts != null){
            budgetYear.setIndirectCosts(indirectCosts);
        }
        budgetYear.setCognizantFederalAgency(periodInfo.getCognizantFedAgency());
        budgetYear.setTotalCosts(periodInfo.getTotalCosts().bigDecimalValue());
        for (Narrative narrative : pdDoc.getDevelopmentProposal().getNarratives()) {
            if (narrative.getNarrativeTypeCode() != null
                    && Integer.parseInt(narrative.getNarrativeTypeCode()) == BUDGET_JUSTIFICATION_ATTACHMENT) {
                budgetYear.setBudgetJustificationAttachment(getAttachedFileType(narrative));
            }
        }
        return budgetYear;
    }

    /**
     * This method gets BudgetYearDataType details like BudgetPeriodStartDate,BudgetPeriodEndDate,BudgetPeriod
     * KeyPersons,OtherPersonnel,TotalCompensation,Equipment,ParticipantTraineeSupportCosts,Travel,OtherDirectCosts
     * DirectCosts,IndirectCosts,CognizantFederalAgency,TotalCosts based on BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return BudgetYearDataType corresponding to the BudgetPeriodInfo entry.
     */
    private BudgetYearDataType getBudgetYearDataType(BudgetPeriodInfo periodInfo) {

        BudgetYearDataType budgetYear = BudgetYearDataType.Factory.newInstance();
        if (periodInfo != null) {
            if (periodInfo.getStartDate() != null) {
                budgetYear.setBudgetPeriodStartDate(s2sUtilService.convertDateToCalendar(periodInfo.getStartDate()));
            }
            if (periodInfo.getEndDate() != null) {
                budgetYear.setBudgetPeriodEndDate(s2sUtilService.convertDateToCalendar(periodInfo.getEndDate()));
            }
            BudgetPeriod.Enum budgetPeriod = BudgetPeriod.Enum.forInt(periodInfo.getBudgetPeriod());
            budgetYear.setBudgetPeriod(budgetPeriod);
            budgetYear.setKeyPersons(getKeyPersons(periodInfo));
            budgetYear.setOtherPersonnel(getOtherPersonnel(periodInfo));
            if (periodInfo.getTotalCompensation() != null) {
                budgetYear.setTotalCompensation(periodInfo.getTotalCompensation().bigDecimalValue());
            }
            budgetYear.setEquipment(getEquipment(periodInfo));
            budgetYear.setTravel(getTravel(periodInfo));
            budgetYear.setParticipantTraineeSupportCosts(getParticipantTraineeSupportCosts(periodInfo));
            budgetYear.setOtherDirectCosts(getOtherDirectCosts(periodInfo));
            if (periodInfo.getDirectCostsTotal() != null) {
                budgetYear.setDirectCosts(periodInfo.getDirectCostsTotal().bigDecimalValue());
            }
            budgetYear.setIndirectCosts(getIndirectCosts(periodInfo));
            budgetYear.setCognizantFederalAgency(periodInfo.getCognizantFedAgency());
            if (periodInfo.getTotalCosts() != null) {
                budgetYear.setTotalCosts(periodInfo.getTotalCosts().bigDecimalValue());
            }
        }
        return budgetYear;
    }

    /**
     * This method gets BudgetSummary details such as
     * CumulativeTotalFundsRequestedSeniorKeyPerson,CumulativeTotalFundsRequestedOtherPersonnel
     * CumulativeTotalNoOtherPersonnel,CumulativeTotalFundsRequestedPersonnel,CumulativeEquipments,CumulativeTravels
     * CumulativeTrainee,CumulativeOtherDirect,CumulativeTotalFundsRequestedDirectCosts,CumulativeTotalFundsRequestedIndirectCost
     * CumulativeTotalFundsRequestedDirectIndirectCosts and CumulativeFee based on BudgetSummaryInfo for the RRBudget.
     * 
     * @param budgetSummaryData (BudgetSummaryInfo) budget summary info entry.
     * @return BudgetSummary details corresponding to the BudgetSummaryInfo object.
     */
    private BudgetSummary getBudgetSummary(BudgetSummaryInfo budgetSummaryData) {

        BudgetSummary budgetSummary = BudgetSummary.Factory.newInstance();
        // Set default values for mandatory fields
        budgetSummary.setCumulativeTotalFundsRequestedSeniorKeyPerson(BigDecimal.ZERO);
        budgetSummary.setCumulativeTotalFundsRequestedPersonnel(BigDecimal.ZERO);
        budgetSummary.setCumulativeTotalFundsRequestedDirectCosts(BigDecimal.ZERO);

        if (budgetSummaryData != null) {
            if (budgetSummaryData.getCumTotalFundsForSrPersonnel() != null) {
                budgetSummary.setCumulativeTotalFundsRequestedSeniorKeyPerson(budgetSummaryData.getCumTotalFundsForSrPersonnel()
                        .bigDecimalValue());
            }
            if (budgetSummaryData.getCumTotalFundsForOtherPersonnel() != null) {
                budgetSummary.setCumulativeTotalFundsRequestedOtherPersonnel(budgetSummaryData.getCumTotalFundsForOtherPersonnel()
                        .bigDecimalValue());
            }
            if (budgetSummaryData.getCumNumOtherPersonnel() != null) {
                budgetSummary.setCumulativeTotalNoOtherPersonnel(budgetSummaryData.getCumNumOtherPersonnel().intValue());
            }
            if (budgetSummaryData.getCumTotalFundsForPersonnel() != null) {
                budgetSummary.setCumulativeTotalFundsRequestedPersonnel(budgetSummaryData.getCumTotalFundsForPersonnel()
                        .bigDecimalValue());
            }
            budgetSummary.setCumulativeEquipments(getCumulativeEquipments(budgetSummaryData));
            budgetSummary.setCumulativeTravels(getCumulativeTravels(budgetSummaryData));
            budgetSummary.setCumulativeTrainee(getCumulativeTrainee(budgetSummaryData));
            budgetSummary.setCumulativeOtherDirect(getCumulativeOtherDirect(budgetSummaryData));
            if (budgetSummaryData.getCumTotalDirectCosts() != null) {
                budgetSummary.setCumulativeTotalFundsRequestedDirectCosts(budgetSummaryData.getCumTotalDirectCosts()
                        .bigDecimalValue());
            }
            if (budgetSummaryData.getCumTotalIndirectCosts() != null) {
                budgetSummary.setCumulativeTotalFundsRequestedIndirectCost(budgetSummaryData.getCumTotalIndirectCosts()
                        .bigDecimalValue());
            }
            if (budgetSummaryData.getCumTotalCosts() != null) {
                budgetSummary.setCumulativeTotalFundsRequestedDirectIndirectCosts(budgetSummaryData.getCumTotalCosts()
                        .bigDecimalValue());
            }
            if (budgetSummaryData.getCumFee() != null) {
                budgetSummary.setCumulativeFee(budgetSummaryData.getCumFee().bigDecimalValue());
            }
        }
        return budgetSummary;
    }

    /**
     * This method gets CumulativeEquipments information CumulativeTotalFundsRequestedEquipment based on BudgetSummaryInfo for the
     * form RRBudget.
     * 
     * @param budgetSummaryData (BudgetSummaryInfo) budget summary info entry.
     * @return CumulativeEquipments details corresponding to the BudgetSummaryInfo object.
     */
    private CumulativeEquipments getCumulativeEquipments(BudgetSummaryInfo budgetSummaryData) {

        CumulativeEquipments cumulativeEquipments = CumulativeEquipments.Factory.newInstance();
        if (budgetSummaryData.getCumEquipmentFunds() != null) {
            cumulativeEquipments.setCumulativeTotalFundsRequestedEquipment(budgetSummaryData.getCumEquipmentFunds()
                    .bigDecimalValue());
        }
        return cumulativeEquipments;
    }

    /**
     * This method gets CumulativeTravels details,CumulativeTotalFundsRequestedTravel,CumulativeDomesticTravelCosts and
     * CumulativeForeignTravelCosts based on BudgetSummaryInfo for the RRBudget.
     * 
     * @param budgetSummaryData (BudgetSummaryInfo) budget summary info entry.
     * @return CumulativeTravels details corresponding to the BudgetSummaryInfo object.
     */
    private CumulativeTravels getCumulativeTravels(BudgetSummaryInfo budgetSummaryData) {
        CumulativeTravels cumulativeTravels = CumulativeTravels.Factory.newInstance();
        if (budgetSummaryData != null) {
            if (budgetSummaryData.getCumTravelNonFund() != null) {
                cumulativeTravels.setCumulativeTotalFundsRequestedTravel(budgetSummaryData.getCumTravelNonFund().bigDecimalValue());
            }
            else {
                cumulativeTravels.setCumulativeTotalFundsRequestedTravel(BigDecimal.ZERO);
            }
            if (budgetSummaryData.getCumDomesticTravel() != null) {
                cumulativeTravels.setCumulativeDomesticTravelCosts(budgetSummaryData.getCumDomesticTravel().bigDecimalValue());
            }
            if (budgetSummaryData.getCumForeignTravel() != null) {
                cumulativeTravels.setCumulativeForeignTravelCosts(budgetSummaryData.getCumForeignTravel().bigDecimalValue());
            }
        }
        return cumulativeTravels;
    }

    /**
     * This method gets CumulativeTrainee details,
     * CumulativeTotalFundsRequestedTraineeCosts,CumulativeTraineeTuitionFeesHealthInsurance
     * CumulativeTraineeStipends,CumulativeTraineeTravel,CumulativeTraineeSubsistence,CumulativeOtherTraineeCost and
     * CumulativeNoofTrainees based on BudgetSummaryInfo for the RRBudget.
     * 
     * @param budgetSummaryData (BudgetSummaryInfo) budget summary info entry.
     * @return CumulativeTrainee details corresponding to the BudgetSummaryInfo object.
     */
    private CumulativeTrainee getCumulativeTrainee(BudgetSummaryInfo budgetSummaryData) {
        CumulativeTrainee cumulativeTrainee = CumulativeTrainee.Factory.newInstance();
        cumulativeTrainee.setCumulativeTotalFundsRequestedTraineeCosts(BigDecimal.ZERO);
        if (budgetSummaryData != null) {
            if (budgetSummaryData.getpartOtherCost() != null && budgetSummaryData.getpartStipendCost() != null
                    && budgetSummaryData.getpartTravelCost() != null && budgetSummaryData.getPartTuition() != null) {
                cumulativeTrainee.setCumulativeTotalFundsRequestedTraineeCosts(budgetSummaryData.getpartOtherCost().add(
                        budgetSummaryData.getpartStipendCost().add(
                                budgetSummaryData.getpartTravelCost().add(
                                        budgetSummaryData.getPartTuition().add(budgetSummaryData.getPartSubsistence()))))
                        .bigDecimalValue());
            }
            if (budgetSummaryData.getPartTuition() != null) {
                cumulativeTrainee.setCumulativeTraineeTuitionFeesHealthInsurance(budgetSummaryData.getPartTuition()
                        .bigDecimalValue());
            }
            if (budgetSummaryData.getpartStipendCost() != null) {
                cumulativeTrainee.setCumulativeTraineeStipends(budgetSummaryData.getpartStipendCost().bigDecimalValue());
            }
            if (budgetSummaryData.getpartTravelCost() != null) {
                cumulativeTrainee.setCumulativeTraineeTravel(budgetSummaryData.getpartTravelCost().bigDecimalValue());
            }
            if (budgetSummaryData.getPartSubsistence() != null) {
                cumulativeTrainee.setCumulativeTraineeSubsistence(budgetSummaryData.getPartSubsistence().bigDecimalValue());
            }
            if (budgetSummaryData.getpartOtherCost() != null) {
                cumulativeTrainee.setCumulativeOtherTraineeCost(budgetSummaryData.getpartOtherCost().bigDecimalValue());
            }
            cumulativeTrainee.setCumulativeNoofTrainees(budgetSummaryData.getparticipantCount());
        }
        return cumulativeTrainee;
    }

    /**
     * This method gets CumulativeOtherDirectCost details,CumulativeMaterialAndSupplies,CumulativePublicationCosts,
     * CumulativeConsultantServices,CumulativeADPComputerServices,CumulativeSubawardConsortiumContractualCosts
     * CumulativeEquipmentFacilityRentalFees,CumulativeAlterationsAndRenovations and CumulativeOther1DirectCost based on
     * BudgetSummaryInfo for the RRBudget.
     * 
     * @param budgetSummaryData (BudgetSummaryInfo) budget summary info entry.
     * @return CumulativeOtherDirect details corresponding to the BudgetSummaryInfo object.
     */
    private CumulativeOtherDirect getCumulativeOtherDirect(BudgetSummaryInfo budgetSummaryData) {
        CumulativeOtherDirect cumulativeOtherDirect = CumulativeOtherDirect.Factory.newInstance();
        cumulativeOtherDirect.setCumulativeTotalFundsRequestedOtherDirectCosts(BigDecimal.ZERO);
        if (budgetSummaryData != null) {
            for (OtherDirectCostInfo cumOtherDirect : budgetSummaryData.getOtherDirectCosts()) {
                if (cumOtherDirect.gettotalOtherDirect() != null) {
                    cumulativeOtherDirect.setCumulativeTotalFundsRequestedOtherDirectCosts(cumOtherDirect.gettotalOtherDirect()
                            .bigDecimalValue());
                }
                if (cumOtherDirect.getmaterials() != null) {
                    cumulativeOtherDirect.setCumulativeMaterialAndSupplies(cumOtherDirect.getmaterials().bigDecimalValue());
                }
                if (cumOtherDirect.getpublications() != null) {
                    cumulativeOtherDirect.setCumulativePublicationCosts(cumOtherDirect.getpublications().bigDecimalValue());
                }
                if (cumOtherDirect.getConsultants() != null) {
                    cumulativeOtherDirect.setCumulativeConsultantServices(cumOtherDirect.getConsultants().bigDecimalValue());
                }
                if (cumOtherDirect.getcomputer() != null) {
                    cumulativeOtherDirect.setCumulativeADPComputerServices(cumOtherDirect.getcomputer().bigDecimalValue());
                }
                if (cumOtherDirect.getsubAwards() != null) {
                    cumulativeOtherDirect.setCumulativeSubawardConsortiumContractualCosts(cumOtherDirect.getsubAwards()
                            .bigDecimalValue());
                }
                if (cumOtherDirect.getEquipRental() != null) {
                    cumulativeOtherDirect.setCumulativeEquipmentFacilityRentalFees(cumOtherDirect.getEquipRental()
                            .bigDecimalValue());
                }
                if (cumOtherDirect.getAlterations() != null) {
                    cumulativeOtherDirect.setCumulativeAlterationsAndRenovations(cumOtherDirect.getAlterations().bigDecimalValue());
                }
                if (cumOtherDirect.getOtherCosts() != null && cumOtherDirect.getOtherCosts().size() > 0) {
                    cumulativeOtherDirect.setCumulativeOther1DirectCost(new BigDecimal(cumOtherDirect.getOtherCosts().get(0).get(
                            S2SConstants.KEY_COST)));
                }
            }
        }
        return cumulativeOtherDirect;
    }

    /**
     * This method gets KeyPersons details such as Name,ProjectRole,Compensation,TotalFundForAttachedKeyPersons
     * TotalFundForKeyPersons and AttachedKeyPersons based on BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return KeyPersons details corresponding to the BudgetPeriodInfo object.
     */
    private KeyPersons getKeyPersons(BudgetPeriodInfo periodInfo) {

        KeyPersons keyPersons = KeyPersons.Factory.newInstance();
        BudgetDecimal extraFunds = BudgetDecimal.ZERO;
        if (periodInfo != null) {
            KeyPersonDataType[] keyPersonDataTypeArray = null;
            if (periodInfo.getKeyPersons() != null) {
                keyPersonDataTypeArray = new KeyPersonDataType[periodInfo.getKeyPersons().size()];
            }
            if (keyPersonDataTypeArray != null) {
                int keyPersonCount = 0;
                for (KeyPersonInfo keyPerson : periodInfo.getKeyPersons()) {
                    KeyPersonDataType keyPersonDataType = KeyPersonDataType.Factory.newInstance();
                    extraFunds = extraFunds.add(keyPerson.getFundsRequested());
                    keyPersonDataType.setName(globLibV10Generator.getHumanNameDataType(keyPerson));
                    keyPersonDataType.setProjectRole(keyPerson.getRole());
                    keyPersonDataType.setCompensation(getCompensation(keyPerson));
                    keyPersonDataTypeArray[keyPersonCount] = keyPersonDataType;
                    keyPersonCount++;
                    LOG.info("keyPersonCount:" + keyPersonCount);
                }
                keyPersons.setKeyPersonArray(keyPersonDataTypeArray);
            }
            
           
            TotalFundForAttachedKeyPersons totalFundForAttachedKeyPersons = TotalFundForAttachedKeyPersons.Factory.newInstance();
            totalFundForAttachedKeyPersons.setTotalFundForAttachedKeyPersonsExist(YesNoDataType.YES);
            totalFundForAttachedKeyPersons.setBigDecimalValue(extraFunds.bigDecimalValue());
            keyPersons.setTotalFundForAttachedKeyPersons(totalFundForAttachedKeyPersons);
            
            if (periodInfo.getTotalFundsKeyPersons() != null) {
                keyPersons.setTotalFundForKeyPersons(periodInfo.getTotalFundsKeyPersons().bigDecimalValue());
            }
            
            for (Narrative narrative : pdDoc.getDevelopmentProposal().getNarratives()) {
                if (narrative.getNarrativeTypeCode() != null
                        && Integer.parseInt(narrative.getNarrativeTypeCode()) == ADDITIONAL_KEYPERSONS_ATTACHMENT) {
                    AttachedKeyPersons attachedKeyPersons = AttachedKeyPersons.Factory.newInstance();
                    FileLocation fileLocation = FileLocation.Factory.newInstance();
                    attachedKeyPersons.setFileLocation(fileLocation);
                    LinkedHashMap<String, String> attMap = new LinkedHashMap<String, String>();
                    attMap.put(MODULE_NUMBER, String.valueOf(narrative.getModuleNumber()));
                    if (narrative.getNarrativeType() != null) {
                        attMap.put(DESCRIPTION, narrative.getNarrativeType().getDescription());
                    }
                    String contentId = createContentId(attMap);
                    fileLocation.setHref(contentId);
                    attachedKeyPersons.setFileLocation(fileLocation);
                    attachedKeyPersons.setFileName(narrative.getFileName());
                    attachedKeyPersons.setMimeType(S2SConstants.CONTENT_TYPE_OCTET_STREAM);
                    narrative.refreshReferenceObject(NARRATIVE_ATTACHMENT_LIST);
                    if (narrative.getNarrativeAttachmentList() != null && narrative.getNarrativeAttachmentList().size() > 0) {
                        attachedKeyPersons.setHashValue(getHashValue(narrative.getNarrativeAttachmentList().get(0).getContent()));
                    }
                    AttachmentData attachmentData = new AttachmentData();
                    if (narrative.getNarrativeAttachmentList() != null && narrative.getNarrativeAttachmentList().size() > 0) {
                        attachmentData.setContent(narrative.getNarrativeAttachmentList().get(0).getContent());
                    }
                    attachmentData.setContentId(contentId);
                    attachmentData.setContentType(S2SConstants.CONTENT_TYPE_OCTET_STREAM);
                    attachmentData.setFileName(narrative.getFileName());
                    addAttachment(attachmentData);
                    attachedKeyPersons.setTotalFundForAttachedKeyPersonsExist(YesNoDataType.YES);
                    keyPersons.setAttachedKeyPersons(attachedKeyPersons);
                }
            }
        }
        return keyPersons;
    }


    /**
     * This method gets KeyPersonCompensationDataType informations such as AcademicMonths,CalendarMonths,FringeBenefits
     * SummerMonths,RequestedSalary,FundsRequested and BaseSalary based on KeyPersonInfo for the keyPerson.
     * 
     * @param keyPerson (KeyPersonInfo) key person entry.
     * @return KeyPersonCompensationDataType details corresponding to the KeyPersonInfo object.
     */
    private KeyPersonCompensationDataType getCompensation(KeyPersonInfo keyPerson) {

        KeyPersonCompensationDataType keyPersonCompensation = KeyPersonCompensationDataType.Factory.newInstance();
        if (keyPerson != null) {
            if (keyPerson.getAcademicMonths() != null) {
                keyPersonCompensation.setAcademicMonths(keyPerson.getAcademicMonths().bigDecimalValue());
            }
            if (keyPerson.getCalendarMonths() != null) {
                keyPersonCompensation.setCalendarMonths(keyPerson.getCalendarMonths().bigDecimalValue());
            }
            if (keyPerson.getFringe() != null) {
                keyPersonCompensation.setFringeBenefits(keyPerson.getFringe().bigDecimalValue());
            }
            if (keyPerson.getSummerMonths() != null) {
                keyPersonCompensation.setSummerMonths(keyPerson.getSummerMonths().bigDecimalValue());
            }
            if (keyPerson.getRequestedSalary() != null) {
                keyPersonCompensation.setRequestedSalary(keyPerson.getRequestedSalary().bigDecimalValue());
            }
            if (keyPerson.getFundsRequested() != null) {
                keyPersonCompensation.setFundsRequested(keyPerson.getFundsRequested().bigDecimalValue());
            }
            if (keyPerson.getBaseSalary() != null) {
                keyPersonCompensation.setBaseSalary(keyPerson.getBaseSalary().bigDecimalValue());
            }
        }
        return keyPersonCompensation;
    }

    /**
     * This method gets SectBCompensationDataType details AcademicMonths,CalendarMonths,FringeBenefits
     * FundsRequested,SummerMonths,and RequestedSalary based on KeyPersonInfo for the OtherPersonnel.
     * 
     * @param compensation (CompensationInfo) compensation entry.
     * @return SectBCompensationDataType details corresponding to the CompensationInfo object.
     */
    private SectBCompensationDataType getSectBCompensationDataType(CompensationInfo compensation) {

        SectBCompensationDataType sectBCompensation = SectBCompensationDataType.Factory.newInstance();
        if (compensation != null) {
            if (compensation.getAcademicMonths() != null) {
                sectBCompensation.setAcademicMonths(compensation.getAcademicMonths().bigDecimalValue());
            }
            if (compensation.getCalendarMonths() != null) {
                sectBCompensation.setCalendarMonths(compensation.getCalendarMonths().bigDecimalValue());
            }
            if (compensation.getFringe() != null) {
                sectBCompensation.setFringeBenefits(compensation.getFringe().bigDecimalValue());
            }
            if (compensation.getFundsRequested() != null) {
                sectBCompensation.setFundsRequested(compensation.getFundsRequested().bigDecimalValue());
            }
            if (compensation.getSummerMonths() != null) {
                sectBCompensation.setSummerMonths(compensation.getSummerMonths().bigDecimalValue());
            }
            if (compensation.getRequestedSalary() != null) {
                sectBCompensation.setRequestedSalary(compensation.getRequestedSalary().bigDecimalValue());
            }
        }
        return sectBCompensation;
    }

    /**
     * This method gets OtherPersonnel informations like PostDocAssociates,GraduateStudents,UndergraduateStudents
     * SecretarialClerical based on PersonnelType and also gets NumberOfPersonnel, ProjectRole,Compensation
     * OtherPersonnelTotalNumber and TotalOtherPersonnelFund based on BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return OtherPersonnel details corresponding to the BudgetPeriodInfo object.
     */
    private OtherPersonnel getOtherPersonnel(BudgetPeriodInfo periodInfo) {
        OtherPersonnel otherPersonnel = OtherPersonnel.Factory.newInstance();
        int OtherpersonalCount = 0;
        List<OtherPersonnelDataType> otherPersonnelList = new ArrayList<OtherPersonnelDataType>();
        OtherPersonnelDataType otherPersonnelDataTypeArray[] = new OtherPersonnelDataType[1];
        if (periodInfo != null) {
            for (OtherPersonnelInfo otherPersonnelInfo : periodInfo.getOtherPersonnel()) {
                if (OTHERPERSONNEL_POSTDOC.equals(otherPersonnelInfo.getPersonnelType())) {
                    otherPersonnel.setPostDocAssociates(getPostDocAssociates(otherPersonnelInfo));
                }
                else if (OTHERPERSONNEL_GRADUATE.equals(otherPersonnelInfo.getPersonnelType())) {
                    otherPersonnel.setGraduateStudents(getGraduateStudents(otherPersonnelInfo));
                }
                else if (OTHERPERSONNEL_UNDERGRADUATE.equals(otherPersonnelInfo.getPersonnelType())) {
                    otherPersonnel.setUndergraduateStudents(getUndergraduateStudents(otherPersonnelInfo));
                }
                else if (OTHERPERSONNEL_SECRETARIAL.equals(otherPersonnelInfo.getPersonnelType())) {
                    otherPersonnel.setSecretarialClerical(getSecretarialClerical(otherPersonnelInfo));
                }
                else if (OtherpersonalCount < OTHERPERSONNEL_MAX_ALLOWED) {// Max allowed is 6
                    OtherPersonnelDataType otherPersonnelDataType = OtherPersonnelDataType.Factory.newInstance();
                    otherPersonnelDataType.setNumberOfPersonnel(otherPersonnelInfo.getNumberPersonnel());
                    otherPersonnelDataType.setProjectRole(otherPersonnelInfo.getRole());
                    otherPersonnelDataType.setCompensation(getSectBCompensationDataType(otherPersonnelInfo.getCompensation()));
                    otherPersonnelList.add(otherPersonnelDataType);
                    OtherpersonalCount++;
                }
            }
            otherPersonnelDataTypeArray = otherPersonnelList.toArray(otherPersonnelDataTypeArray);
            otherPersonnel.setOtherArray(otherPersonnelDataTypeArray);

            if (periodInfo.getOtherPersonnelTotalNumber() != null) {
                otherPersonnel.setOtherPersonnelTotalNumber(periodInfo.getOtherPersonnelTotalNumber().intValue());
            }
            if (periodInfo.getTotalOtherPersonnelFunds() != null) {
                otherPersonnel.setTotalOtherPersonnelFund(periodInfo.getTotalOtherPersonnelFunds().bigDecimalValue());
            }
        }
        return otherPersonnel;
    }

    /**
     * This method gets the PostDocAssociates details,ProjectRole, NumberOfPersonnel,Compensation based on OtherPersonnelInfo for
     * the RRBudget,if it is a PostDocAssociates type.
     * 
     * @param otherPersonnel (OtherPersonnelInfo) other personnel entry.
     * @return PostDocAssociates details corresponding to the OtherPersonnelInfo object.
     */
    private PostDocAssociates getPostDocAssociates(OtherPersonnelInfo otherPersonnel) {

        PostDocAssociates postDocAssociates = PostDocAssociates.Factory.newInstance();
        if (otherPersonnel != null) {
            postDocAssociates.setNumberOfPersonnel(otherPersonnel.getNumberPersonnel());
            postDocAssociates.setProjectRole(otherPersonnel.getRole());
            postDocAssociates.setCompensation(getSectBCompensationDataType(otherPersonnel.getCompensation()));
        }
        return postDocAssociates;
    }

    /**
     * This method gets the GraduateStudents details,ProjectRole, NumberOfPersonnel,Compensation based on OtherPersonnelInfo for the
     * RRBudget, if it is a GraduateStudents type.
     * 
     * @param otherPersonnel (OtherPersonnelInfo) other personnel entry.
     * @return GraduateStudents details corresponding to the OtherPersonnelInfo object.
     */
    private GraduateStudents getGraduateStudents(OtherPersonnelInfo otherPersonnel) {

        GraduateStudents graduate = GraduateStudents.Factory.newInstance();
        if (otherPersonnel != null) {
            graduate.setNumberOfPersonnel(otherPersonnel.getNumberPersonnel());
            graduate.setProjectRole(otherPersonnel.getRole());
            graduate.setCompensation(getSectBCompensationDataType(otherPersonnel.getCompensation()));
        }
        return graduate;
    }

    /**
     * This method is to get the UndergraduateStudents details,ProjectRole, NumberOfPersonnel,Compensation based on
     * OtherPersonnelInfo for the RRBudget,if it is a UndergraduateStudents type.
     * 
     * @param otherPersonnel (OtherPersonnelInfo) other personnel entry.
     * @return UndergraduateStudents details corresponding to the OtherPersonnelInfo object.
     */
    private UndergraduateStudents getUndergraduateStudents(OtherPersonnelInfo otherPersonnel) {

        UndergraduateStudents undergraduate = UndergraduateStudents.Factory.newInstance();
        if (otherPersonnel != null) {
            undergraduate.setNumberOfPersonnel(otherPersonnel.getNumberPersonnel());
            undergraduate.setProjectRole(otherPersonnel.getRole());
            undergraduate.setCompensation(getSectBCompensationDataType(otherPersonnel.getCompensation()));
        }
        return undergraduate;
    }

    /**
     * This method is to get the SecretarialClerical details,ProjectRole, NumberOfPersonnel,Compensation based on OtherPersonnelInfo
     * for the RRBudget,if it is a SecretarialClerical type.
     * 
     * @param otherPersonnel (OtherPersonnelInfo) other personnel entry.
     * @return SecretarialClerical corresponding to the OtherPersonnelInfo object.
     */
    private SecretarialClerical getSecretarialClerical(OtherPersonnelInfo otherPersonnel) {

        SecretarialClerical secretarialClerical = SecretarialClerical.Factory.newInstance();
        if (otherPersonnel != null) {
            secretarialClerical.setNumberOfPersonnel(otherPersonnel.getNumberPersonnel());
            secretarialClerical.setProjectRole(otherPersonnel.getRole());
            secretarialClerical.setCompensation(getSectBCompensationDataType(otherPersonnel.getCompensation()));
        }
        return secretarialClerical;
    }

    /**
     * This method gets Equipment details such as EquipmentItem,FundsRequested,TotalFundForAttachedEquipment, TotalFund and
     * AdditionalEquipmentsAttachment based on BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return Equipment costs corresponding to the BudgetPeriodInfo object.
     */
    private Equipment getEquipment(BudgetPeriodInfo periodInfo) {
        Equipment equipment = Equipment.Factory.newInstance();
        if (periodInfo != null && periodInfo.getEquipment() != null && periodInfo.getEquipment().size() > 0) {
            List<EquipmentList> equipmentArrayList = new ArrayList<EquipmentList>();
            for (CostInfo costInfo : periodInfo.getEquipment().get(0).getEquipmentList()) {
                EquipmentList equipmentList = EquipmentList.Factory.newInstance();
                equipmentList.setEquipmentItem(costInfo.getCategory());
                if (costInfo.getCost() != null) {
                    equipmentList.setFundsRequested(costInfo.getCost().bigDecimalValue());
                }
                equipmentArrayList.add(equipmentList);
            }
            EquipmentList[] equipmentArray = new EquipmentList[0];
            equipmentArray = equipmentArrayList.toArray(equipmentArray);
            equipment.setEquipmentListArray(equipmentArray);
            TotalFundForAttachedEquipment totalFund = TotalFundForAttachedEquipment.Factory.newInstance();
            totalFund.setTotalFundForAttachedEquipmentExist(YesNoDataType.YES);
            totalFund.setBigDecimalValue(periodInfo.getEquipment().get(0).getTotalExtraFund().bigDecimalValue());
            equipment.setTotalFundForAttachedEquipment(totalFund);
            if (periodInfo.getEquipment().get(0).getTotalFund() != null) {
                equipment.setTotalFund(periodInfo.getEquipment().get(0).getTotalFund().bigDecimalValue());
            }
        }

        for (Narrative narrative : pdDoc.getDevelopmentProposal().getNarratives()) {
            if (narrative.getNarrativeTypeCode() != null
                    && Integer.parseInt(narrative.getNarrativeTypeCode()) == ADDITIONAL_EQUIPMENT_ATTACHMENT) {
                AdditionalEquipmentsAttachment equipmentAttachment = AdditionalEquipmentsAttachment.Factory.newInstance();
                FileLocation fileLocation = FileLocation.Factory.newInstance();
                equipmentAttachment.setFileLocation(fileLocation);
                LinkedHashMap<String, String> attMap = new LinkedHashMap<String, String>();
                attMap.put(MODULE_NUMBER, String.valueOf(narrative.getModuleNumber()));
                attMap.put(DESCRIPTION, narrative.getNarrativeType().getDescription());
                String contentId = createContentId(attMap);
                fileLocation.setHref(contentId);
                equipmentAttachment.setFileLocation(fileLocation);
                equipmentAttachment.setFileName(narrative.getFileName());
                equipmentAttachment.setMimeType(S2SConstants.CONTENT_TYPE_OCTET_STREAM);
                narrative.refreshReferenceObject(NARRATIVE_ATTACHMENT_LIST);
                equipmentAttachment.setHashValue(getHashValue(narrative.getNarrativeAttachmentList().get(0).getContent()));
                AttachmentData attachmentData = new AttachmentData();
                attachmentData.setContent(narrative.getNarrativeAttachmentList().get(0).getContent());
                attachmentData.setContentId(contentId);
                attachmentData.setContentType(S2SConstants.CONTENT_TYPE_OCTET_STREAM);
                attachmentData.setFileName(narrative.getFileName());
                addAttachment(attachmentData);
                equipmentAttachment.setTotalFundForAttachedEquipmentExist(YesNoDataType.YES);
                equipment.setAdditionalEquipmentsAttachment(equipmentAttachment);
            }
        }
        return equipment;
    }

    /**
     * This method gets Travel cost information including DomesticTravelCost,ForeignTravelCost and TotalTravelCost in the
     * BudgetYearDataType based on BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return Travel travel cost corresponding to the BudgetPeriodInfo object.
     */
    private Travel getTravel(BudgetPeriodInfo periodInfo) {

        Travel travel = Travel.Factory.newInstance();
        if (periodInfo != null) {
            if (periodInfo.getDomesticTravelCost() != null) {
                travel.setDomesticTravelCost(periodInfo.getDomesticTravelCost().bigDecimalValue());
            }
            if (periodInfo.getForeignTravelCost() != null) {
                travel.setForeignTravelCost(periodInfo.getForeignTravelCost().bigDecimalValue());
            }
            if (periodInfo.getTotalTravelCost() != null) {
                travel.setTotalTravelCost(periodInfo.getTotalTravelCost().bigDecimalValue());
            }
        }
        return travel;
    }

    /**
     * This method gets ParticipantTraineeSupportCosts details in BudgetYearDataType such as TuitionFeeHealthInsurance
     * Stipends,Subsistence,Travel,Other,ParticipantTraineeNumber and TotalCost based on the BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return ParticipantTraineeSupportCosts corresponding to the BudgetPeriodInfo object.
     */
    private ParticipantTraineeSupportCosts getParticipantTraineeSupportCosts(BudgetPeriodInfo periodInfo) {
        ParticipantTraineeSupportCosts traineeSupportCosts = ParticipantTraineeSupportCosts.Factory.newInstance();
        if (periodInfo != null) {
            traineeSupportCosts.setTuitionFeeHealthInsurance(periodInfo.getPartTuition().bigDecimalValue());
            traineeSupportCosts.setStipends(periodInfo.getpartStipendCost().bigDecimalValue());
            traineeSupportCosts.setTravel(periodInfo.getpartTravelCost().bigDecimalValue());
            traineeSupportCosts.setSubsistence(periodInfo.getPartSubsistence().bigDecimalValue());
            traineeSupportCosts.setOther(getOtherPTSupportCosts(periodInfo));
            traineeSupportCosts.setParticipantTraineeNumber(periodInfo.getparticipantCount());
            traineeSupportCosts.setTotalCost(traineeSupportCosts.getTuitionFeeHealthInsurance().add(
                    traineeSupportCosts.getStipends().add(
                            traineeSupportCosts.getTravel().add(
                                    traineeSupportCosts.getSubsistence().add(traineeSupportCosts.getOther().getCost())))));
        }
        return traineeSupportCosts;
    }

    /**
     * This method gets Other type description and total cost for ParticipantTraineeSupportCosts based on BudgetPeriodInfo.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return Other other participant trainee support costs corresponding to the BudgetPeriodInfo object.
     */
    private Other getOtherPTSupportCosts(BudgetPeriodInfo periodInfo) {
        Other other = Other.Factory.newInstance();
        other.setDescription(OTHERCOST_DESCRIPTION);
        BudgetDecimal otherCost = BudgetDecimal.ZERO;
        if (periodInfo != null && periodInfo.getpartOtherCost() != null) {
            otherCost = periodInfo.getpartOtherCost();
        }
        other.setCost(otherCost.bigDecimalValue());
        return other;
    }

    /**
     * This method gets OtherDirectCosts details such as PublicationCosts,MaterialsSupplies,ConsultantServices,
     * ADPComputerServices,SubawardConsortiumContractualCosts,EquipmentRentalFee,AlterationsRenovations and TotalOtherDirectCost in
     * BudgetYearDataType based on BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return OtherDirectCosts corresponding to the BudgetPeriodInfo object.
     */
    private OtherDirectCosts getOtherDirectCosts(BudgetPeriodInfo periodInfo) {

        OtherDirectCosts otherDirectCosts = OtherDirectCosts.Factory.newInstance();
        if (periodInfo != null && periodInfo.getOtherDirectCosts() != null && periodInfo.getOtherDirectCosts().size() > 0) {
            if (periodInfo.getOtherDirectCosts().get(0).getpublications() != null) {
                otherDirectCosts.setPublicationCosts(periodInfo.getOtherDirectCosts().get(0).getpublications().bigDecimalValue());
            }
            if (periodInfo.getOtherDirectCosts().get(0).getmaterials() != null) {
                otherDirectCosts.setMaterialsSupplies(periodInfo.getOtherDirectCosts().get(0).getmaterials().bigDecimalValue());
            }
            if (periodInfo.getOtherDirectCosts().get(0).getConsultants() != null) {
                otherDirectCosts.setConsultantServices(periodInfo.getOtherDirectCosts().get(0).getConsultants().bigDecimalValue());
            }
            if (periodInfo.getOtherDirectCosts().get(0).getcomputer() != null) {
                otherDirectCosts.setADPComputerServices(periodInfo.getOtherDirectCosts().get(0).getcomputer().bigDecimalValue());
            }
            if (periodInfo.getOtherDirectCosts().get(0).getsubAwards() != null) {
                otherDirectCosts.setSubawardConsortiumContractualCosts(periodInfo.getOtherDirectCosts().get(0).getsubAwards()
                        .bigDecimalValue());
            }
            if (periodInfo.getOtherDirectCosts().get(0).getEquipRental() != null) {
                otherDirectCosts.setEquipmentRentalFee(periodInfo.getOtherDirectCosts().get(0).getEquipRental().bigDecimalValue());
            }
            if (periodInfo.getOtherDirectCosts().get(0).getAlterations() != null) {
                otherDirectCosts.setAlterationsRenovations(periodInfo.getOtherDirectCosts().get(0).getAlterations()
                        .bigDecimalValue());
            }
            otherDirectCosts.setOthers(getOthersForOtherDirectCosts(periodInfo));
            if (periodInfo.getOtherDirectCosts().get(0).gettotalOtherDirect() != null) {
                otherDirectCosts.setTotalOtherDirectCost(periodInfo.getOtherDirectCosts().get(0).gettotalOtherDirect()
                        .bigDecimalValue());
            }
        }
        return otherDirectCosts;
    }

    /**
     * This method is to get Other type description and total cost OtherDirectCosts details in BudgetYearDataType based on
     * BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return Other others for other direct costs corresponding to the BudgetPeriodInfo object.
     */
    private Others getOthersForOtherDirectCosts(BudgetPeriodInfo periodInfo) {

        Others others = Others.Factory.newInstance();
        if (periodInfo != null) {
            Others.Other otherArray[] = new Others.Other[periodInfo.getOtherDirectCosts().size()];
            int Otherscount = 0;
            for (OtherDirectCostInfo otherDirectCostInfo : periodInfo.getOtherDirectCosts()) {
                Others.Other other = Others.Other.Factory.newInstance();
                if (otherDirectCostInfo.getOtherCosts() != null && otherDirectCostInfo.getOtherCosts().size() > 0) {
                    other.setCost(new BigDecimal(otherDirectCostInfo.getOtherCosts().get(0).get(S2SConstants.KEY_COST)));
                }
                other.setDescription(OTHERCOST_DESCRIPTION);
                otherArray[Otherscount] = other;
                Otherscount++;
            }
            others.setOtherArray(otherArray);
        }
        return others;
    }

    /**
     * This method returns IndirectCosts details such as Base,CostType,FundRequested,Rate and TotalIndirectCosts in
     * BudgetYearDataType based on BudgetPeriodInfo for the RRBudget.
     * 
     * @param periodInfo (BudgetPeriodInfo) budget period entry.
     * @return IndirectCosts corresponding to the BudgetPeriodInfo object.
     */
    private IndirectCosts getIndirectCosts(BudgetPeriodInfo periodInfo) {

        IndirectCosts indirectCosts = null;
       
        if (periodInfo != null) {
            List<IndirectCosts.IndirectCost> indirectCostList = new ArrayList<IndirectCosts.IndirectCost>();
            int IndirectCostCount = 0;
            for (IndirectCostDetails indirectCostDetails : periodInfo.getIndirectCosts().getIndirectCostDetails()) {
                IndirectCosts.IndirectCost indirectCost = IndirectCosts.IndirectCost.Factory.newInstance();
                indirectCost.setBase(indirectCostDetails.getBase().bigDecimalValue());
                indirectCost.setCostType(indirectCostDetails.getCostType());
                indirectCost.setFundRequested(indirectCostDetails.getFunds().bigDecimalValue());
                indirectCost.setRate(indirectCostDetails.getRate().bigDecimalValue());
                indirectCostList.add(indirectCost);
                IndirectCostCount++;
                if (IndirectCostCount == ARRAY_LIMIT_IN_SCHEMA) {
                    LOG.warn("Stopping iteration over indirect cost details because array limit in schema is only 4");
                    break;
                }
            }
            if(IndirectCostCount>0){
                indirectCosts = IndirectCosts.Factory.newInstance();
                IndirectCosts.IndirectCost indirectCostArray[] = new IndirectCosts.IndirectCost[0];
                indirectCosts.setIndirectCostArray(indirectCostList.toArray(indirectCostArray));
                indirectCosts.setTotalIndirectCosts(periodInfo.getIndirectCosts().getTotalIndirectCosts().bigDecimalValue());
            }
        }
        return indirectCosts;
    }

    /**
     * This method creates {@link XmlObject} of type {@link RRBudgetDocument} by populating data from the given
     * {@link ProposalDevelopmentDocument}
     * 
     * @param proposalDevelopmentDocument for which the {@link XmlObject} needs to be created
     * @return {@link XmlObject} which is generated using the given {@link ProposalDevelopmentDocument}
     * @see org.kuali.kra.s2s.generator.S2SFormGenerator#getFormObject(ProposalDevelopmentDocument)
     */
    public XmlObject getFormObject(ProposalDevelopmentDocument proposalDevelopmentDocument) {
        this.pdDoc = proposalDevelopmentDocument;
        return getRRBudget();
    }

    /**
     * This method typecasts the given {@link XmlObject} to the required generator type and returns back the document of that
     * generator type.
     * 
     * @param xmlObject which needs to be converted to the document type of the required generator
     * @return {@link XmlObject} document of the required generator type
     * @see org.kuali.kra.s2s.generator.S2SFormGenerator#getFormObject(XmlObject)
     */
    public XmlObject getFormObject(XmlObject xmlObject) {
        RRBudget rrBudget = (RRBudget) xmlObject;
        RRBudgetDocument rrBudgetDocument = RRBudgetDocument.Factory.newInstance();
        rrBudgetDocument.setRRBudget(rrBudget);
        return rrBudgetDocument;
    }
}
